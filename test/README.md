# Feature Tests

這個目錄包含了所有 features 的測試檔案。

## 自動化測試系統

我們的 CI/CD 系統會自動：
1. 發現 `src/` 目錄下的所有 features
2. 為每個 feature 執行測試
3. 無需手動維護測試矩陣

## 測試檔案結構

每個 feature 的測試都位於 `test/<feature-name>/` 目錄下：

```
test/
├── <feature-name>/
│   ├── test.sh          # 主要測試腳本
│   └── scenarios.json   # 測試場景配置
└── README.md           # 這個檔案
```

## 為新 Feature 創建測試

### 方法 1: 使用自動生成腳本（推薦）

```bash
# 為新的 feature 自動生成測試模板
./scripts/generate-test.sh <feature-name>

# 例如：
./scripts/generate-test.sh my-new-feature
```

### 方法 2: 手動創建

1. 創建測試目錄：
   ```bash
   mkdir -p test/<feature-name>
   ```

2. 創建 `test.sh`：
   ```bash
   #!/usr/bin/env bash
   set -e
   source dev-container-features-test-lib

   check "feature is installed" <feature-command> --version
   # 添加更多測試...

   reportResults
   ```

3. 創建 `scenarios.json`：
   ```json
   {
     "scenarios": [
       {
         "name": "<feature-name>-basic",
         "image": "mcr.microsoft.com/devcontainers/base:ubuntu",
         "features": {
           "ghcr.io/yang-lin94/feature/<feature-name>:1": {}
         }
       }
     ]
   }
   ```

## 本地測試

```bash
# 測試特定 feature
devcontainer features test -f <feature-name> .

# 測試所有 features
devcontainer features test .

# 只測試場景（跳過自動生成測試）
devcontainer features test -f <feature-name> --skip-autogenerated .

# 只測試自動生成測試（跳過場景）
devcontainer features test -f <feature-name> --skip-scenarios .
```

## 測試最佳實踐

1. **基本檢查**：
   - 驗證命令是否可用
   - 檢查版本輸出
   - 確認安裝位置

2. **功能測試**：
   - 測試基本功能
   - 驗證配置檔案
   - 檢查依賴關係

3. **清理**：
   - 移除測試產生的檔案
   - 恢復測試環境

4. **錯誤處理**：
   - 使用 `set -e` 確保錯誤時停止
   - 提供清晰的錯誤訊息

## CI/CD 整合

測試會在以下情況自動執行：
- 推送到 `main` 分支
- 創建 Pull Request
- 手動觸發 workflow

每個 feature 會並行測試，提高效率。